# Test info

- Name: Teacher Interface - Comprehensive Test Suite >> Teacher-Student Interaction >> should transmit teacher's speech to student as translated text and enable audio playback
- Location: /Users/yamijala/gitprojects/AIVoiceTranslator/tests/e2e/teacher.spec.ts:661:5

# Error details

```
Error: Timed out 10000ms waiting for expect(locator).toContainText(expected)

Locator: locator('#translation-display')
- Expected string  - 1
+ Received string  + 8

- Hola, esta es una transcripci√≥n de prueba
+
+                 
+                     Original: Hello, this is a test transcription
+                 
+                 
+                     Translation: Hola, esto es una transcripci√≥n de prueba.
+                 
+             
Call log:
  - expect.toContainText with timeout 10000ms
  - waiting for locator('#translation-display')
    13 √ó locator resolved to <div class="translation-box" id="translation-display">‚Ä¶</div>
       - unexpected value "
                
                    Original: Hello, this is a test transcription
                
                
                    Translation: Hola, esto es una transcripci√≥n de prueba.
                
            "

    at /Users/yamijala/gitprojects/AIVoiceTranslator/tests/e2e/teacher.spec.ts:711:49
```

# Test source

```ts
  611 |         await studentPage.waitForTimeout(1000); // Adjust as needed
  612 |         
  613 |         // Verify student language change was processed and status remains connected or updates appropriately
  614 |         const selectedLang = await studentPage.locator('#language-dropdown').inputValue();
  615 |         expect(selectedLang).toBe('de-DE');
  616 |         // Re-check connection status if language change might affect it
  617 |         await expect(studentPage.locator('#connection-status')).toContainText('Connected', { timeout: 5000 });
  618 |
  619 |       } finally {
  620 |         await studentPage.close();
  621 |         await studentContext.close();
  622 |       }
  623 |     });
  624 |
  625 |     test('should handle student reconnection', async ({ browser }) => {
  626 |       const studentContext = await browser.newContext();
  627 |       const studentPage = await studentContext.newPage();
  628 |       
  629 |       try {
  630 |         await expect(page.locator('#status')).toContainText('Registered as teacher', { timeout: 10000 });
  631 |         const classroomCodeElement = page.locator('#classroom-code-display');
  632 |         const classroomCode = await classroomCodeElement.textContent();
  633 |         expect(classroomCode).toBeTruthy();
  634 |         
  635 |         await studentPage.goto(`http://127.0.0.1:5001/student?code=${classroomCode}`);
  636 |         await studentPage.waitForLoadState('domcontentloaded');
  637 |
  638 |         // Student selects language and connects
  639 |         await studentPage.selectOption('#language-dropdown', 'fr-FR'); // French for this test
  640 |         await studentPage.click('#connect-btn');
  641 |         await expect(studentPage.locator('#connection-status')).toContainText('Connected', { timeout: 10000 });
  642 |         
  643 |         // Simulate reconnection by reloading
  644 |         await studentPage.reload();
  645 |         await studentPage.waitForLoadState('domcontentloaded');
  646 |         
  647 |         // After reload, student needs to select language and click connect again
  648 |         await studentPage.selectOption('#language-dropdown', 'fr-FR'); // Re-select language
  649 |         await studentPage.click('#connect-btn'); // Re-click connect
  650 |
  651 |         // Verify student reconnected
  652 |         await expect(studentPage.locator('#connection-status')).toContainText('Connected', { timeout: 10000 });
  653 |         
  654 |         await expect(page.locator('#status')).toContainText('Registered as teacher');
  655 |       } finally {
  656 |         await studentPage.close();
  657 |         await studentContext.close();
  658 |       }
  659 |     });
  660 |
  661 |     test('should transmit teacher\'s speech to student as translated text and enable audio playback', async ({ browser }) => {
  662 |       // 1. Teacher Setup
  663 |       await expect(page.locator('#status')).toContainText('Registered as teacher', { timeout: 10000 });
  664 |       const classroomCodeElement = page.locator('#classroom-code-display');
  665 |       await expect(classroomCodeElement).toBeVisible();
  666 |       const classroomCode = await classroomCodeElement.textContent();
  667 |       expect(classroomCode).toBeTruthy();
  668 |       if (classroomCode) { // Type guard for classroomCode
  669 |         expect(classroomCode).toMatch(/^[A-Z0-9]{6}$/);
  670 |       } else {
  671 |         throw new Error("Classroom code was null or empty");
  672 |       }
  673 |
  674 |       // 2. Student Setup
  675 |       const studentContext = await browser.newContext();
  676 |       const studentPage = await studentContext.newPage();
  677 |       try {
  678 |         await studentPage.goto(`http://127.0.0.1:5001/student?code=${classroomCode}`);
  679 |         await studentPage.waitForLoadState('domcontentloaded');
  680 |
  681 |         // Student selects Spanish
  682 |         await studentPage.selectOption('#language-dropdown', 'es-ES');
  683 |         // Assuming the #selected-language display updates like: "Selected: üá™üá∏ Spanish (Spain)"
  684 |         await expect(studentPage.locator('#selected-language')).toContainText('Selected: üá™üá∏ Spanish (Spain)', { timeout: 2000 });
  685 |
  686 |         // Student connects
  687 |         await studentPage.click('#connect-btn');
  688 |         await expect(studentPage.locator('#connection-status span')).toContainText('Connected', { timeout: 10000 });
  689 |         await expect(studentPage.locator('#translation-display')).toContainText('Waiting for teacher to start speaking...');
  690 |
  691 |         // 3. Teacher Action
  692 |         const recordButton = page.locator('#recordButton');
  693 |         await recordButton.click(); // Start recording
  694 |         await expect(page.locator('#status')).toContainText('Recording... Speak naturally');
  695 |
  696 |         const teacherTranscription = 'Hello, this is a test transcription';
  697 |         // Wait for teacher's UI to show the mock transcription
  698 |         await expect(page.locator('#transcription')).toContainText(teacherTranscription, { timeout: 3000 });
  699 |
  700 |         // 4. Student Verification
  701 |         const studentTranslationDisplay = studentPage.locator('#translation-display');
  702 |         
  703 |         // Check for original text on student page
  704 |         await expect(studentTranslationDisplay).toContainText(teacherTranscription, { timeout: 15000 });
  705 |         
  706 |         // Check that the "waiting" message is gone
  707 |         await expect(studentTranslationDisplay).not.toContainText('Waiting for teacher to start speaking...');
  708 |         
  709 |         // Check for translated text (EXAMPLE - this might need adjustment based on actual translation service output)
  710 |         const expectedSpanishTranslation = 'Hola, esta es una transcripci√≥n de prueba'; 
> 711 |         await expect(studentTranslationDisplay).toContainText(expectedSpanishTranslation, { timeout: 10000 }); 
      |                                                 ^ Error: Timed out 10000ms waiting for expect(locator).toContainText(expected)
  712 |
  713 |         // Stop recording
  714 |         await recordButton.click(); 
  715 |         await expect(page.locator('#status')).toContainText('Recording stopped');
  716 |
  717 |         // Check if Play Audio button is enabled (assuming server sends TTS audio)
  718 |         const playButton = studentPage.locator('#play-button');
  719 |         await expect(playButton).toBeEnabled({ timeout: 5000 });
  720 |
  721 |       } finally {
  722 |         // Cleanup
  723 |         await studentPage.close();
  724 |         await studentContext.close();
  725 |       }
  726 |     });
  727 |   });
  728 |
  729 |   // TODO: Revisit this test. Simulating network disconnection reliably in E2E is complex.
  730 |   test.skip('should handle connection loss and reconnection', async () => {
  731 |     // This test is skipped because simulating network disconnection reliably in an E2E test
  732 |     // without external tools or complex browser manipulation is difficult and can be flaky.
  733 |     // Testing WebSocket reconnection logic is often better suited for integration tests
  734 |     // where WebSocket server behavior can be more directly controlled and observed.
  735 |   });
  736 | });
```