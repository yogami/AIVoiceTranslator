# Test info

- Name: Teacher Interface - Comprehensive Test Suite >> Basic UI and Connection >> should default to German language on page load
- Location: /Users/yamijala/gitprojects/AIVoiceTranslator/tests/e2e/teacher.spec.ts:138:3

# Error details

```
Error: expect(received).toBe(expected) // Object.is equality

Expected: "de"
Received: "de-DE"
    at /Users/yamijala/gitprojects/AIVoiceTranslator/tests/e2e/teacher.spec.ts:144:27
```

# Test source

```ts
   44 |         state = 'inactive';
   45 |         ondataavailable: ((event: any) => void) | null = null;
   46 |         onstop: (() => void) | null = null;
   47 |         
   48 |         constructor(stream: any, options: any) {
   49 |           console.log('MockMediaRecorder created with options:', options);
   50 |         }
   51 |         
   52 |         start(timeslice?: number) {
   53 |           console.log('MockMediaRecorder started with timeslice:', timeslice);
   54 |           this.state = 'recording';
   55 |           
   56 |           // Simulate data available events
   57 |           if (this.ondataavailable) {
   58 |             setTimeout(() => {
   59 |               const mockBlob = new Blob(['mock audio data'], { type: 'audio/webm' });
   60 |               if (this.ondataavailable) {
   61 |                 this.ondataavailable({ data: mockBlob });
   62 |               }
   63 |             }, 150);
   64 |           }
   65 |         }
   66 |         
   67 |         stop() {
   68 |           console.log('MockMediaRecorder stopped');
   69 |           this.state = 'inactive';
   70 |           if (this.onstop) {
   71 |             this.onstop();
   72 |           }
   73 |         }
   74 |         
   75 |         static isTypeSupported(mimeType: string) {
   76 |           return mimeType === 'audio/webm' || mimeType === 'audio/ogg';
   77 |         }
   78 |       };
   79 |       
   80 |       // Mock getUserMedia
   81 |       Object.defineProperty(navigator, 'mediaDevices', {
   82 |         writable: true,
   83 |         value: {
   84 |           getUserMedia: async (constraints: any) => {
   85 |             console.log('getUserMedia called with constraints:', constraints);
   86 |             return mockStream as any;
   87 |           }
   88 |         }
   89 |       });
   90 |       
   91 |       // Mock Speech Recognition
   92 |       (window as any).webkitSpeechRecognition = class MockSpeechRecognition {
   93 |         continuous = false;
   94 |         interimResults = false;
   95 |         lang = 'en-US';
   96 |         onresult: ((event: any) => void) | null = null;
   97 |         onerror: ((event: any) => void) | null = null;
   98 |         onend: (() => void) | null = null;
   99 |         
  100 |         start() {
  101 |           console.log('Speech recognition started');
  102 |           // Simulate a transcription result after a delay
  103 |           setTimeout(() => {
  104 |             if (this.onresult) {
  105 |               this.onresult({
  106 |                 resultIndex: 0,
  107 |                 results: [{
  108 |                   isFinal: true,
  109 |                   0: { transcript: 'Hello, this is a test transcription' }
  110 |                 }]
  111 |               });
  112 |             }
  113 |           }, 500);
  114 |         }
  115 |         
  116 |         stop() {
  117 |           console.log('Speech recognition stopped');
  118 |           if (this.onend) {
  119 |             this.onend();
  120 |           }
  121 |         }
  122 |       };
  123 |     });
  124 |     
  125 |     // Navigate to teacher page
  126 |     await page.goto('http://127.0.0.1:5001/teacher'); 
  127 |     await page.waitForLoadState('domcontentloaded');
  128 |   });
  129 |
  130 |   test.afterEach(async () => {
  131 |     if (page) {
  132 |       await page.close();
  133 |     }
  134 |   });
  135 |
  136 |   // Basic UI Tests
  137 |   test.describe('Basic UI and Connection', () => {
  138 |   test('should default to German language on page load', async () => {
  139 |     // Wait for the language dropdown to be visible
  140 |     await expect(page.locator('#teacherLanguage')).toBeVisible();
  141 |     
  142 |     // Check that German (de) is selected by default
  143 |     const selectedValue = await page.locator('#teacherLanguage').inputValue();
> 144 |     expect(selectedValue).toBe('de');
      |                           ^ Error: expect(received).toBe(expected) // Object.is equality
  145 |     
  146 |     // Also check the displayed text
  147 |     const selectedText = await page.locator('#teacherLanguage option:checked').textContent();
  148 |     expect(selectedText).toContain('German');
  149 |   });
  150 |
  151 |   test('should display initial UI elements correctly', async () => {
  152 |     // Check h1 (main heading)
  153 |     const mainHeading = page.locator('h1');
  154 |     await expect(mainHeading).toBeVisible();
  155 |     await expect(mainHeading).toContainText('Teacher Interface');
  156 |
  157 |     // Check other essential UI elements
  158 |     await expect(page.locator('#teacherLanguage')).toBeVisible();
  159 |     
  160 |     const recordButton = page.locator('#recordButton');
  161 |     await expect(recordButton).toBeVisible();
  162 |     await expect(recordButton).toBeEnabled(); 
  163 |     await expect(recordButton).toHaveText('Start Recording'); 
  164 |     
  165 |     await expect(page.locator('#transcription')).toBeVisible(); 
  166 |   });
  167 |
  168 |   test('should establish WebSocket connection automatically', async () => {
  169 |     // Wait for auto-connection status message
  170 |       await expect(page.locator('#status')).toContainText('Registered as teacher', { timeout: 10000 });
  171 |     });
  172 |
  173 |     test('should display classroom code and QR code', async () => {
  174 |       // Wait for WebSocket connection and registration
  175 |       await expect(page.locator('#status')).toContainText('Registered as teacher', { timeout: 10000 });
  176 |       
  177 |       // Check classroom code is displayed
  178 |       const classroomCode = page.locator('#classroom-code-display');
  179 |       await expect(classroomCode).toBeVisible();
  180 |       
  181 |       // Code should be 6 characters
  182 |       const codeText = await classroomCode.textContent();
  183 |       expect(codeText).toMatch(/^[A-Z0-9]{6}$/);
  184 |       
  185 |       // Student URL should be displayed
  186 |       const studentUrl = page.locator('#studentUrl');
  187 |       await expect(studentUrl).toContainText(`/student?code=${codeText}`);
  188 |       
  189 |       // QR code container should exist and have a canvas
  190 |       const qrCodeContainer = page.locator('#qr-code');
  191 |       await expect(qrCodeContainer).toBeVisible();
  192 |       
  193 |       // Check that QR code canvas exists (it might be inside the container)
  194 |       const qrCanvas = qrCodeContainer.locator('canvas');
  195 |       const canvasCount = await qrCanvas.count();
  196 |       expect(canvasCount).toBeGreaterThan(0);
  197 |     });
  198 |   });
  199 |
  200 |   // Language Selection Tests
  201 |   test.describe('Language Selection', () => {
  202 |   test('should handle language selection', async () => {
  203 |     // Wait for connection first, as language change might trigger re-registration
  204 |     await expect(page.locator('#status')).toContainText('Registered as teacher', { timeout: 10000 });
  205 |     
  206 |     // Change language
  207 |     await page.selectOption('#teacherLanguage', 'es-ES'); // Spanish (Spain)
  208 |     const selectedValue = await page.locator('#teacherLanguage').inputValue();
  209 |     expect(selectedValue).toBe('es-ES');
  210 |     
  211 |     // The application should ideally re-register with the new language.
  212 |     await page.waitForTimeout(1000); 
  213 |   });
  214 |
  215 |     test('should handle language changes during recording', async () => {
  216 |       // Wait for WebSocket connection
  217 |       await expect(page.locator('#status')).toContainText('Registered as teacher', { timeout: 10000 });
  218 |       
  219 |       // Change language
  220 |       const languageSelect = page.locator('#teacherLanguage');
  221 |       await languageSelect.selectOption('es-ES');
  222 |       
  223 |       // Track registration messages
  224 |       const wsMessages: any[] = [];
  225 |       page.on('websocket', ws => {
  226 |         ws.on('framesent', event => {
  227 |           try {
  228 |             const data = JSON.parse(event.payload as string);
  229 |             if (data.type === 'register') {
  230 |               wsMessages.push(data);
  231 |             }
  232 |           } catch (e) {
  233 |             // Not JSON
  234 |           }
  235 |         });
  236 |       });
  237 |       
  238 |       // Wait a bit for the registration to be sent
  239 |       await page.waitForTimeout(500);
  240 |       
  241 |       // Start recording to verify language is used
  242 |       const recordButton = page.locator('#recordButton');
  243 |       await recordButton.click();
  244 |       
```