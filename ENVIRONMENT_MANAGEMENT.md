# 🔐 Environment Variable Management Guide

## 📊 Environment Variable Architecture

### 🎯 Three-Layer Strategy
1. **Development** (`.env`) - Local development only
2. **Testing** (`.env.test`) - CI/CD and local testing
3. **Production** (Railway Platform) - Live deployment

## 🔧 Current Setup Analysis

### ✅ What's Already Configured
- **`.env.test`**: Complete test environment configuration
- **`.env.production`**: Production template created
- **GitHub Secrets**: For CI/CD pipeline variables
- **Railway Variables**: For runtime environment variables

### 🚀 Production Environment Variables

Your production environment will be managed by Railway platform variables:

```bash
# Core Application
PORT=$PORT                                    # Auto-set by Railway
HOST=0.0.0.0                                 # Container binding
NODE_ENV=production

# Database (Auto-configured by Railway PostgreSQL addon)
DATABASE_URL=$DATABASE_URL                    # Auto-set by Railway

# OpenAI Integration
OPENAI_API_KEY=sk-your-production-key-here    # Set manually
TTS_SERVICE_TYPE=openai

# Frontend URLs (Update with your Railway domain)
VITE_API_URL=https://your-app.railway.app
VITE_WS_URL=wss://your-app.railway.app

# Session Management
SESSION_SECRET=your-production-secret-here    # Generate secure secret
SESSION_TIMEOUT=3600000                       # 1 hour
INACTIVE_SESSION_TIMEOUT=1800000             # 30 minutes

# Feature Flags
ENABLE_DETAILED_TRANSLATION_LOGGING=true
ENABLE_AUDIO_CACHING=true
ENABLE_SESSION_PERSISTENCE=true

# Logging
LOG_LEVEL=info                               # Production logging
```

## 🔄 Environment Variable Flow

### Development → Testing → Production
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Development   │    │     Testing     │    │   Production    │
│     .env        │    │   .env.test     │    │ Railway Platform│
├─────────────────┤    ├─────────────────┤    ├─────────────────┤
│ Local database  │    │ Aiven PostgreSQL│    │Railway PostgreSQL│
│ Development API │    │ Real OpenAI API │    │ Real OpenAI API │
│ localhost:5001  │    │ 127.0.0.1:5001  │    │ your-app.railway│
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 🛠️ Management Methods

### 1. Railway Dashboard (Recommended)
```bash
# Access Railway dashboard
railway login
railway open

# Set variables via web interface
# Variables → Add Variable → Set key/value
```

### 2. Railway CLI
```bash
# Set individual variables
railway variables set OPENAI_API_KEY=sk-your-key-here
railway variables set SESSION_SECRET=your-secret-here

# Set multiple variables from file
railway variables set --file .env.production
```

### 3. GitHub Repository Secrets
```bash
# Used only for CI/CD pipeline
OPENAI_API_KEY=sk-your-key-here
RAILWAY_TOKEN_PRODUCTION=your-railway-token
RAILWAY_SERVICE_ID_PRODUCTION=your-service-id
```

## 🔐 Security Best Practices

### ✅ What to Keep Secret
- **OpenAI API Keys**: Never commit to Git
- **Database URLs**: Auto-generated by Railway
- **Session Secrets**: Generate unique per environment
- **Railway Tokens**: For deployment access only

### ✅ What's Safe to Commit
- **Environment Templates**: `.env.example`, `.env.production`
- **Configuration Structure**: Variable names and descriptions
- **Default Values**: Non-sensitive defaults

### ✅ Git Security
```bash
# Your .gitignore already includes:
.env
.env.local
.env.production
.env.staging
```

## 🎯 Production Setup Steps

### Step 1: Create Production Environment File
```bash
# Copy template
cp .env.production .env.production.local

# Edit with your actual values
nano .env.production.local
```

### Step 2: Set Railway Variables
```bash
# Login to Railway
railway login

# Link to your project
railway link

# Set production variables
railway variables set OPENAI_API_KEY=sk-your-production-key
railway variables set SESSION_SECRET=$(openssl rand -base64 32)
railway variables set VITE_API_URL=https://your-app.railway.app
railway variables set VITE_WS_URL=wss://your-app.railway.app
```

### Step 3: Verify Configuration
```bash
# Check all variables are set
railway variables

# Test deployment
railway deploy
```

## 🔄 Environment Variable Synchronization

### Development → Production Sync
1. **Test locally** with `.env.test`
2. **Update production template** `.env.production`
3. **Sync to Railway** via dashboard or CLI
4. **Deploy and verify** functionality

### New Variable Checklist
- [ ] Add to `.env.test` for testing
- [ ] Add to `.env.production` template
- [ ] Set in Railway dashboard/CLI
- [ ] Update CI/CD pipeline if needed
- [ ] Test in all environments

## 🚨 Troubleshooting

### Common Issues

**1. Missing Environment Variables**
```bash
# Check Railway variables
railway variables

# Check application logs
railway logs
```

**2. Database Connection Issues**
```bash
# Verify DATABASE_URL is set
railway variables | grep DATABASE_URL

# Test database connection
railway run -- node -e "console.log(process.env.DATABASE_URL)"
```

**3. Frontend URL Mismatches**
```bash
# Update frontend URLs after Railway deployment
railway variables set VITE_API_URL=https://your-actual-domain.railway.app
railway variables set VITE_WS_URL=wss://your-actual-domain.railway.app
```

## 🎛️ Environment Variable Categories

### 🔴 Critical (Must Set)
- `OPENAI_API_KEY` - OpenAI API access
- `DATABASE_URL` - Database connection (auto-set by Railway)
- `SESSION_SECRET` - Session security
- `VITE_API_URL` - Frontend API endpoint
- `VITE_WS_URL` - WebSocket endpoint

### 🟡 Important (Should Set)
- `LOG_LEVEL` - Logging verbosity
- `SESSION_TIMEOUT` - Session duration
- `ENABLE_DETAILED_TRANSLATION_LOGGING` - Feature flag

### 🟢 Optional (Has Defaults)
- `PORT` - Auto-set by Railway
- `HOST` - Defaults to 0.0.0.0
- `NODE_ENV` - Defaults to production

## 📝 Production Deployment Checklist

### Before Deployment
- [ ] OpenAI API key is valid and has credits
- [ ] Database is accessible and migrated
- [ ] All required environment variables are set
- [ ] Frontend URLs point to production domain
- [ ] Session secrets are secure and unique

### After Deployment
- [ ] Health check endpoint responds: `/api/health`
- [ ] Database connections work
- [ ] WebSocket connections establish
- [ ] Translation functionality works
- [ ] Audio features function properly

## 🎉 Self-Contained Benefits

### ✅ Your App is Fully Self-Contained
- **No external dependencies** beyond OpenAI API
- **Database included** with Railway PostgreSQL addon
- **Static assets bundled** in Docker container
- **All configuration** managed through environment variables
- **Health monitoring** built-in

### ✅ Easy Environment Management
- **Single source of truth** for each environment
- **Secure variable handling** with Railway platform
- **Automatic variable injection** in containers
- **Easy updates** via Railway dashboard or CLI
- **Version control** for configuration templates

---

**Your environment variables are completely manageable and secure! 🔐**
