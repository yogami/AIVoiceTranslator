<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Interface - AIVoiceTranslator</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🎧</text></svg>">
    <link rel="stylesheet" href="css/student.css">
    <!-- Modern font for a clean, Gen Z-friendly feel -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Theme selector removed; Modern is always applied -->
    <script>
        // Runtime configuration for student page
        // In production, these will be set by the server or build process
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            // Development/local URLs
            window.VITE_API_URL = `${window.location.protocol}//${window.location.host}`;
            window.VITE_WS_URL = `${window.location.protocol === 'https:' ? 'wss:' : 'ws:'}//${window.location.host}`;
        } else {
            // Production URLs - will be set by Railway environment
            window.VITE_API_URL = window.location.origin;
            window.VITE_WS_URL = `${window.location.protocol === 'https:' ? 'wss:' : 'ws:'}//${window.location.host}`;
        }
        console.log('[student.html] Runtime config - API URL:', window.VITE_API_URL, 'WS URL:', window.VITE_WS_URL);
    </script>
    <script>
      // Permanently enable UI V2 for students (remove u12 alias; ui2 no longer required)
      (function(){
        window.UI_V2 = '1';
        document.addEventListener('DOMContentLoaded', function(){
          document.body.classList.add('ui-v2');
        });
      })();
    </script>
</head>
<body>
    <div class="container">
        <h1>🎧 Student Interface</h1>
        
        <!-- Clear intent: this page is for listening, not speaking -->
        <div class="info-banner" role="note" aria-live="polite">
            This page lets you <strong>listen to your teacher</strong> in your own language. You won’t send audio from here.
            Choose your language below to start receiving live translations.
        </div>
        
        <!-- (UI V2 uses inline connect button in status row) -->

        <!-- Language Selection -->
        <div class="language-section" id="language-step">
            <h3>🌍 Select Your Language for Translations</h3>
            <div class="language-selection">
                <select id="language-dropdown" class="language-dropdown">
                    <option value="">Choose your language...</option>
                    
                    <!-- Major Languages -->
                    <option value="en-US">🇺🇸 English (United States)</option>
                    <option value="en-GB">🇬🇧 English (United Kingdom)</option>
                    <option value="en-AU">🇦🇺 English (Australia)</option>
                    <option value="en-CA">🇨🇦 English (Canada)</option>
                    
                    <!-- European Languages -->
                    <option value="es-ES">🇪🇸 Spanish (Spain)</option>
                    <option value="es-MX">🇲🇽 Spanish (Mexico)</option>
                    <option value="es-AR">🇦🇷 Spanish (Argentina)</option>
                    <option value="fr-FR">🇫🇷 French (France)</option>
                    <option value="fr-CA">🇨🇦 French (Canada)</option>
                    <option value="de-DE">🇩🇪 German (Germany)</option>
                    <option value="it-IT">🇮🇹 Italian (Italy)</option>
                    <option value="pt-PT">🇵🇹 Portuguese (Portugal)</option>
                    <option value="pt-BR">🇧🇷 Portuguese (Brazil)</option>
                    <option value="ru-RU">🇷🇺 Russian (Russia)</option>
                    <option value="pl-PL">🇵🇱 Polish (Poland)</option>
                    <option value="nl-NL">🇳🇱 Dutch (Netherlands)</option>
                    <option value="sv-SE">🇸🇪 Swedish (Sweden)</option>
                    <option value="da-DK">🇩🇰 Danish (Denmark)</option>
                    <option value="no-NO">🇳🇴 Norwegian (Norway)</option>
                    <option value="fi-FI">🇫🇮 Finnish (Finland)</option>
                    <option value="is-IS">🇮🇸 Icelandic (Iceland)</option>
                    <option value="hu-HU">🇭🇺 Hungarian (Hungary)</option>
                    <option value="cs-CZ">🇨🇿 Czech (Czech Republic)</option>
                    <option value="sk-SK">🇸🇰 Slovak (Slovakia)</option>
                    <option value="sl-SI">🇸🇮 Slovenian (Slovenia)</option>
                    <option value="hr-HR">🇭🇷 Croatian (Croatia)</option>
                    <option value="sr-RS">🇷🇸 Serbian (Serbia)</option>
                    <option value="bg-BG">🇧🇬 Bulgarian (Bulgaria)</option>
                    <option value="ro-RO">🇷🇴 Romanian (Romania)</option>
                    <option value="el-GR">🇬🇷 Greek (Greece)</option>
                    <option value="tr-TR">🇹🇷 Turkish (Turkey)</option>
                    
                    <!-- Asian Languages -->
                    <option value="zh-CN">🇨🇳 Chinese (Simplified)</option>
                    <option value="zh-TW">🇹🇼 Chinese (Traditional)</option>
                    <option value="ja-JP">🇯🇵 Japanese (Japan)</option>
                    <option value="ko-KR">🇰🇷 Korean (Korea)</option>
                    <option value="hi-IN">🇮🇳 Hindi (India)</option>
                    <option value="bn-IN">🇮🇳 Bengali (India)</option>
                    <option value="ta-IN">🇮🇳 Tamil (India)</option>
                    <option value="te-IN">🇮🇳 Telugu (India)</option>
                    <option value="mr-IN">🇮🇳 Marathi (India)</option>
                    <option value="gu-IN">🇮🇳 Gujarati (India)</option>
                    <option value="kn-IN">🇮🇳 Kannada (India)</option>
                    <option value="ml-IN">🇮🇳 Malayalam (India)</option>
                    <option value="pa-IN">🇮🇳 Punjabi (India)</option>
                    <option value="ur-PK">🇵🇰 Urdu (Pakistan)</option>
                    <option value="th-TH">🇹🇭 Thai (Thailand)</option>
                    <option value="vi-VN">🇻🇳 Vietnamese (Vietnam)</option>
                    <option value="id-ID">🇮🇩 Indonesian (Indonesia)</option>
                    <option value="ms-MY">🇲🇾 Malay (Malaysia)</option>
                    <option value="tl-PH">🇵🇭 Filipino (Philippines)</option>
                    
                    <!-- Middle Eastern & African Languages -->
                    <option value="ar-SA">🇸🇦 Arabic (Saudi Arabia)</option>
                    <option value="ar-EG">🇪🇬 Arabic (Egypt)</option>
                    <option value="ar-AE">🇦🇪 Arabic (UAE)</option>
                    <option value="he-IL">🇮🇱 Hebrew (Israel)</option>
                    <option value="fa-IR">🇮🇷 Persian (Iran)</option>
                    <option value="sw-KE">🇰🇪 Swahili (Kenya)</option>
                    <option value="am-ET">🇪🇹 Amharic (Ethiopia)</option>
                    <option value="zu-ZA">🇿🇦 Zulu (South Africa)</option>
                    <option value="af-ZA">🇿🇦 Afrikaans (South Africa)</option>
                    
                    <!-- Other Languages -->
                    <option value="cy-GB">🏴󐁧󐁢󐁷󐁬󐁳󐁿 Welsh (Wales)</option>
                    <option value="ga-IE">🇮🇪 Irish (Ireland)</option>
                    <option value="mt-MT">🇲🇹 Maltese (Malta)</option>
                    <option value="lv-LV">🇱🇻 Latvian (Latvia)</option>
                    <option value="lt-LT">🇱🇹 Lithuanian (Lithuania)</option>
                    <option value="et-EE">🇪🇪 Estonian (Estonia)</option>
                    <option value="mk-MK">🇲🇰 Macedonian (North Macedonia)</option>
                    <option value="sq-AL">🇦🇱 Albanian (Albania)</option>
                    <option value="eu-ES">🏴󐁧󐁢󐁢󐁡󐁳󐁿 Basque (Spain)</option>
                    <option value="ca-ES">🏴󐁧󐁢󐁣󐁡󐁴󐁿 Catalan (Spain)</option>
                    <option value="gl-ES">🏴󐁧󐁢󐁧󐁬󐁣󐁿 Galician (Spain)</option>
                </select>
            </div>
            <p class="helper-text">We’ll translate your teacher’s speech into the language you select.</p>
            <div id="selected-language" style="margin-top: 10px; font-weight: bold; color: #2196f3;"></div>
        </div>
        
        <!-- Connection Status and Inline Connect (shown only after language selection) -->
        <div id="connection-status" class="status disconnected hidden">
            <div class="indicator disconnected"></div>
            <span>Disconnected</span>
            <!-- UI V2 badge placeholder for classroom code -->
            <span id="classroom-code-badge" data-testid="student-classroom-badge" style="display:none;"></span>
            <!-- UI V2 inline connect button -->
            <button id="connect-proxy" data-testid="student-connect-proxy" style="display:none;">Connect</button>
        </div>
        
        <!-- Connection Controls (moved directly under language for guided flow) -->
        <div class="controls hidden" id="connect-step">
            <button id="connect-btn" data-testid="student-connect" disabled>Connect to Session</button>
            <div style="margin-top:8px; font-size: 0.9rem; color: #666;">After selecting your language, click Connect to join your classroom.</div>
        </div>
        
        <!-- Translation Display -->
        <div class="translation-container hidden" id="translation-step">
            <h3>📖 Live Translation</h3>
            <div id="translation-display" class="translation-box">
                
            </div>
            <p class="helper-text">Translations will appear here when your teacher is speaking.</p>
        </div>
        
        <!-- Audio Controls -->
        <div class="audio-controls hidden" id="audio-step">
            <button id="play-button" data-testid="student-play" disabled>🔊 Play Translation Audio</button>
            <label for="volume-control">Volume</label>
            <input type="range" id="volume-control" min="0" max="1" step="0.1" value="0.8">
            <div class="helper-text" aria-live="polite">This plays the most recent translation audio. It doesn’t record your voice.</div>
        </div>
        
    </div>

    <script src="js/student.js" defer></script>
    <script>
      // Minimal signaling stubs for future WebRTC path (optional; no-op if WS only)
      window.realtimeSignaling = {
        sendOffer: function(sessionId, sdp) {
          const msg = { type: 'webrtc_offer', sessionId, sdp };
          try { window.appState?.ws?.send?.(JSON.stringify(msg)); } catch {}
        },
        sendAnswer: function(sessionId, sdp) {
          const msg = { type: 'webrtc_answer', sessionId, sdp };
          try { window.appState?.ws?.send?.(JSON.stringify(msg)); } catch {}
        },
        sendIce: function(sessionId, candidate) {
          const msg = { type: 'webrtc_ice_candidate', sessionId, candidate };
          try { window.appState?.ws?.send?.(JSON.stringify(msg)); } catch {}
        }
      };
      // Wire UI V2 inline proxy button to original connect button
      document.addEventListener('DOMContentLoaded', function(){
        if (document.body.classList.contains('ui-v2')) {
          const proxy = document.getElementById('connect-proxy');
          const real = document.getElementById('connect-btn');
          if (proxy) proxy.style.display = 'inline-block';
          if (proxy && real) proxy.addEventListener('click', () => real.click());
        }
      });
    </script>
</body>
</html>
