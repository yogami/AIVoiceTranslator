<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Voice Translator - Teacher Interface</title>
    <link rel="stylesheet" href="/css/teacher.css"> <!-- Changed path here -->
    <!-- Load runtime-config.ts. Vite will process client/src/runtime-config.ts -->
    <script type="module" src="/src/runtime-config.ts"></script>
    
    <!-- Authentication Check -->
    <script>
        // Skip authentication in test mode
        const isTestMode = window.location.search.includes('e2e=true') || 
                          window.location.hostname === '127.0.0.1' && 
                          (window.navigator.userAgent.includes('HeadlessChrome') || 
                           window.navigator.userAgent.includes('Firefox'));
        
        if (!isTestMode) {
            // Check if teacher is authenticated
            const token = localStorage.getItem('teacherToken');
            if (!token) {
                // Redirect to login page if not authenticated
                window.location.href = '/teacher-login';
            } else {
                // Verify token is still valid
                fetch('/api/auth/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        // Token is invalid, redirect to login
                        localStorage.removeItem('teacherToken');
                        localStorage.removeItem('teacherUser');
                        window.location.href = '/teacher-login';
                    } else {
                        return response.json();
                    }
                })
                .then(data => {
                    if (data && data.user) {
                        // Update stored user info if token is valid
                        localStorage.setItem('teacherUser', JSON.stringify(data.user));
                    }
                })
                .catch(() => {
                    // Network error or server down, redirect to login
                    localStorage.removeItem('teacherToken');
                    localStorage.removeItem('teacherUser');
                    window.location.href = '/teacher-login';
                });
            }
        }
    </script>
</head>
<body>
    <div class="container">
        <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h1>🎓 Teacher Interface</h1>
            <div style="display: flex; align-items: center; gap: 15px;">
                <span id="teacher-info" style="color: #666;"></span>
                <button id="logout-btn" style="padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">Logout</button>
            </div>
        </header>
        
        <!-- Single classroom info section at the top -->
        <div class="classroom-info" id="classroomInfo">
            <div>Classroom Code:</div>
            <div class="classroom-code" id="classroom-code-display">LIVE</div>
            <div>Students can join at: <span id="studentUrl">Waiting for connection...</span></div>
            <div id="qr-code"></div>
        </div>
        
        <div class="control-group">
            <label for="teacherLanguage">Your Language:</label>
            <select id="teacherLanguage">
                <!-- Major Languages -->
                <option value="en-US">🇺🇸 English (United States)</option>
                <option value="en-GB">🇬🇧 English (United Kingdom)</option>
                <option value="en-AU">🇦🇺 English (Australia)</option>
                <option value="en-CA">🇨🇦 English (Canada)</option>
                
                <!-- European Languages -->
                <option value="es-ES">🇪🇸 Spanish (Spain)</option>
                <option value="es-MX">🇲🇽 Spanish (Mexico)</option>
                <option value="es-AR">🇦🇷 Spanish (Argentina)</option>
                <option value="fr-FR">🇫🇷 French (France)</option>
                <option value="fr-CA">🇨🇦 French (Canada)</option>
                <option value="de-DE" selected>🇩🇪 German (Germany)</option>
                <option value="it-IT">🇮🇹 Italian (Italy)</option>
                <option value="pt-PT">🇵🇹 Portuguese (Portugal)</option>
                <option value="pt-BR">🇧🇷 Portuguese (Brazil)</option>
                <option value="ru-RU">🇷🇺 Russian (Russia)</option>
                <option value="pl-PL">🇵🇱 Polish (Poland)</option>
                <option value="nl-NL">🇳🇱 Dutch (Netherlands)</option>
                <option value="sv-SE">🇸🇪 Swedish (Sweden)</option>
                <option value="da-DK">🇩🇰 Danish (Denmark)</option>
                <option value="no-NO">🇳🇴 Norwegian (Norway)</option>
                <option value="fi-FI">🇫🇮 Finnish (Finland)</option>
                <option value="is-IS">🇮🇸 Icelandic (Iceland)</option>
                <option value="hu-HU">🇭🇺 Hungarian (Hungary)</option>
                <option value="cs-CZ">🇨🇿 Czech (Czech Republic)</option>
                <option value="sk-SK">🇸🇰 Slovak (Slovakia)</option>
                <option value="sl-SI">🇸🇮 Slovenian (Slovenia)</option>
                <option value="hr-HR">🇭🇷 Croatian (Croatia)</option>
                <option value="sr-RS">🇷🇸 Serbian (Serbia)</option>
                <option value="bg-BG">🇧🇬 Bulgarian (Bulgaria)</option>
                <option value="ro-RO">🇷🇴 Romanian (Romania)</option>
                <option value="el-GR">🇬🇷 Greek (Greece)</option>
                <option value="tr-TR">🇹🇷 Turkish (Turkey)</option>
                
                <!-- Asian Languages -->
                <option value="zh-CN">🇨🇳 Chinese (Simplified)</option>
                <option value="zh-TW">🇹🇼 Chinese (Traditional)</option>
                <option value="ja-JP">🇯🇵 Japanese (Japan)</option>
                <option value="ko-KR">🇰🇷 Korean (Korea)</option>
                <option value="hi-IN">🇮🇳 Hindi (India)</option>
                <option value="bn-IN">🇮🇳 Bengali (India)</option>
                <option value="ta-IN">🇮🇳 Tamil (India)</option>
                <option value="te-IN">🇮🇳 Telugu (India)</option>
                <option value="mr-IN">🇮🇳 Marathi (India)</option>
                <option value="gu-IN">🇮🇳 Gujarati (India)</option>
                <option value="kn-IN">🇮🇳 Kannada (India)</option>
                <option value="ml-IN">🇮🇳 Malayalam (India)</option>
                <option value="pa-IN">🇮🇳 Punjabi (India)</option>
                <option value="ur-PK">🇵🇰 Urdu (Pakistan)</option>
                <option value="th-TH">🇹🇭 Thai (Thailand)</option>
                <option value="vi-VN">🇻🇳 Vietnamese (Vietnam)</option>
                <option value="id-ID">🇮🇩 Indonesian (Indonesia)</option>
                <option value="ms-MY">🇲🇾 Malay (Malaysia)</option>
                <option value="tl-PH">🇵🇭 Filipino (Philippines)</option>
                
                <!-- Middle Eastern & African Languages -->
                <option value="ar-SA">🇸🇦 Arabic (Saudi Arabia)</option>
                <option value="ar-EG">🇪🇬 Arabic (Egypt)</option>
                <option value="ar-AE">🇦🇪 Arabic (UAE)</option>
                <option value="he-IL">🇮🇱 Hebrew (Israel)</option>
                <option value="fa-IR">🇮🇷 Persian (Iran)</option>
                <option value="sw-KE">🇰🇪 Swahili (Kenya)</option>
                <option value="am-ET">🇪🇹 Amharic (Ethiopia)</option>
                <option value="zu-ZA">🇿🇦 Zulu (South Africa)</option>
                <option value="af-ZA">🇿🇦 Afrikaans (South Africa)</option>
                
                <!-- Other Languages -->
                <option value="cy-GB">🏴󐁧󐁢󐁷󐁬󐁳󐁿 Welsh (Wales)</option>
                <option value="ga-IE">🇮🇪 Irish (Ireland)</option>
                <option value="mt-MT">🇲🇹 Maltese (Malta)</option>
                <option value="lv-LV">🇱🇻 Latvian (Latvia)</option>
                <option value="lt-LT">🇱🇹 Lithuanian (Lithuania)</option>
                <option value="et-EE">🇪🇪 Estonian (Estonia)</option>
                <option value="mk-MK">🇲🇰 Macedonian (North Macedonia)</option>
                <option value="sq-AL">🇦🇱 Albanian (Albania)</option>
                <option value="eu-ES">🏴󐁧󐁢󐁢󐁡󐁳󐁿 Basque (Spain)</option>
                <option value="ca-ES">🏴󐁧󐁢󐁣󐁡󐁴󐁿 Catalan (Spain)</option>
                <option value="gl-ES">🏴󐁧󐁢󐁧󐁬󐁣󐁿 Galician (Spain)</option>
            </select>
        </div>
        
        <div class="control-group">
            <button id="recordButton">Start Recording</button>
        </div>
        
        <div class="status" id="status">Ready to connect</div>
        
        <div class="control-group">
            <label>Live Transcription:</label>
            <div id="transcription">Transcribed speech will appear here...</div>
        </div>
        
        <div class="students-list">
            <h3>Connected Students: <span id="studentCount">0</span></h3>
            <div id="studentsList">No students connected yet</div>
        </div>
        
        <div class="session-metrics" id="session-metrics" style="display: none;">
            <h3>📊 Session Metrics</h3>
            <div class="metrics-grid">
                <div class="metric-item">
                    <span class="metric-label">Total Translations:</span>
                    <span id="total-translations">0</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Avg Latency:</span>
                    <span id="avg-latency">0ms</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Session Duration:</span>
                    <span id="session-duration">0:00</span>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="/js/teacher.js" defer></script>
</body>
</html>