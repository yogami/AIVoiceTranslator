
> rest-express@1.0.0 test
> NODE_ENV=test vitest --config=test-config/vitest/vitest.unified.config.mjs --run -t BUGFIX


 RUN  v3.1.4 /Users/yamijala/gitprojects/AIVoiceTranslator

stdout | tests/unit/services/WebSocketServer.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/integration/diagnostics-service.integration.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/integration/services/WebSocketServer.integration.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/unit/services/WebSocketServer.test.ts (89 tests | 89 skipped)
stdout | tests/integration/diagnostics-service.integration.test.ts
OpenAI API key status: Present
OpenAI client initialized successfully

stdout | tests/integration/services/WebSocketServer.integration.test.ts
OpenAI API key status: Present
OpenAI client initialized successfully

stdout | tests/unit/storage/session.storage.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/integration/services/WebSocketServer.integration.test.ts
ðŸ”§ DATABASE: Loading test environment config from .env.test
ðŸ”§ DATABASE: NODE_ENV = test
ðŸ”§ DATABASE: DATABASE_URL exists = [33mtrue[39m
ðŸ”§ DATABASE: DATABASE_URL type = Neon

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests
[SETUP] Initializing test database...
Initializing test database...

stdout | tests/integration/diagnostics-service.integration.test.ts
ðŸ”§ DATABASE: Loading test environment config from .env.test
ðŸ”§ DATABASE: NODE_ENV = test
ðŸ”§ DATABASE: DATABASE_URL exists = [33mtrue[39m
ðŸ”§ DATABASE: DATABASE_URL type = Neon

 â†“ tests/integration/diagnostics-service.integration.test.ts (18 tests | 18 skipped)
stdout | tests/unit/storage/session.storage.test.ts
ðŸ”§ DATABASE: Loading test environment config from .env.test
ðŸ”§ DATABASE: NODE_ENV = test
ðŸ”§ DATABASE: DATABASE_URL exists = [33mtrue[39m
ðŸ”§ DATABASE: DATABASE_URL type = Neon

 â†“ tests/unit/storage/session.storage.test.ts (33 tests | 33 skipped)
stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests
All tables cleared.

stdout | tests/integration/storage/DatabaseStorage-integration.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/unit/services/TextToSpeechService.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/unit/services/TextToSpeechService.test.ts (19 tests | 19 skipped)
stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests
Default test data added.

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests
Test database initialized successfully.

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
[TEST] Setting up isolated database and server...
[TestIsolation] Creating fresh storage for websocket-integration-test
[TestIsolation] Resetting database for websocket-integration-test

stdout | tests/unit/services/DiagnosticsService.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
2025-07-04 00:25:43 [[32minfo[39m]: DatabaseStorage reset complete for test environment.

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
[TestIsolation] Initializing default languages for websocket-integration-test

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
[TestIsolation] Database ready for websocket-integration-test

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
[TEST] HTTP server started on port 56862

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
2025-07-04 00:25:44 [[32minfo[39m]: Started classroom session cleanup task
2025-07-04 00:25:44 [[32minfo[39m]: Session lifecycle management started
2025-07-04 00:25:44 [[32minfo[39m]: SessionCountCacheService started
[TEST] Setup complete

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
=== START: Session lifecycle bug test with REAL backend ===
[DEBUG] Creating WebSocket for path: / (client #1) on port 56862

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
2025-07-04 00:25:44 [[32minfo[39m]: New WebSocket connection established
2025-07-04 00:25:44 [[32minfo[39m]: New WebSocket connection established
2025-07-04 00:25:44 [[32minfo[39m]: Sending connection confirmation: {"sessionId":"session-1-1751581544311","classroomCode":null}
2025-07-04 00:25:44 [[32minfo[39m]: Connection confirmation sent successfully

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
[DEBUG] WebSocket OPENED for client #1
[DEBUG] Client #1 received message: connection

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
2025-07-04 00:25:44 [[32minfo[39m]: Starting session cleanup service
2025-07-04 00:25:44 [[32minfo[39m]: SessionCleanupService started

stdout | tests/integration/storage/DatabaseStorage-integration.test.ts
ðŸ”§ DATABASE: Loading test environment config from .env.test
ðŸ”§ DATABASE: NODE_ENV = test
ðŸ”§ DATABASE: DATABASE_URL exists = [33mtrue[39m
ðŸ”§ DATABASE: DATABASE_URL type = Neon

 â†“ tests/integration/storage/DatabaseStorage-integration.test.ts (24 tests | 24 skipped)
stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
[TEST] Found message of type connection for client #1: {
  type: [32m'connection'[39m,
  status: [32m'connected'[39m,
  sessionId: [32m'session-1-1751581544311'[39m
}

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
[TEST] Sending message to client #1: {
  type: [32m'register'[39m,
  role: [32m'teacher'[39m,
  languageCode: [32m'en-US'[39m,
  name: [32m'Test Teacher'[39m
}

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
2025-07-04 00:25:44 [[32minfo[39m]: Processing message type=register from connection: {"role":"teacher","languageCode":"en-US","name":"Test Teacher"}
2025-07-04 00:25:44 [[32minfo[39m]: Changing connection role from undefined to teacher

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
2025-07-04 00:25:44 [[32minfo[39m]: Creating session for teacher: {"sessionId":"session-1-1751581544311"}

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
[DbSessionStorage.createSession] Attempting to insert session: {
  sessionId: [32m'session-1-1751581544311'[39m,
  values: {
    sessionId: [32m'session-1-1751581544311'[39m,
    isActive: [33mfalse[39m,
    teacherLanguage: [1mnull[22m,
    classCode: [1mnull[22m,
    studentLanguage: [1mnull[22m,
    lastActivityAt: [35m2025-07-03T22:25:44.541Z[39m
  }
}

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
[DbSessionStorage.createSession] Successfully inserted session: {
  id: [33m4750[39m,
  sessionId: [32m'session-1-1751581544311'[39m,
  classCode: [1mnull[22m,
  teacherLanguage: [1mnull[22m,
  studentLanguage: [1mnull[22m,
  startTime: [35m2025-07-03T22:25:44.541Z[39m,
  endTime: [1mnull[22m,
  studentsCount: [33m0[39m,
  totalTranslations: [33m0[39m,
  averageLatency: [1mnull[22m,
  isActive: [33mtrue[39m,
  quality: [32m'unknown'[39m,
  qualityReason: [1mnull[22m,
  lastActivityAt: [35m2025-07-03T22:25:44.541Z[39m
}

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
2025-07-04 00:25:44 [[32minfo[39m]: Successfully created new session in storage: {"sessionId":"session-1-1751581544311"}

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
2025-07-04 00:25:44 [[32minfo[39m]: Created new classroom session: 7TYYCE for session session-1-1751581544311
[DbSessionStorage.updateSession] Attempting to update session: {
  sessionId: [32m'session-1-1751581544311'[39m,
  updates: { teacherLanguage: [32m'en-US'[39m }
}

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
[DbSessionStorage.updateSession] Successfully updated session: {
  id: [33m4750[39m,
  sessionId: [32m'session-1-1751581544311'[39m,
  classCode: [1mnull[22m,
  teacherLanguage: [32m'en-US'[39m,
  studentLanguage: [1mnull[22m,
  startTime: [35m2025-07-03T22:25:44.541Z[39m,
  endTime: [1mnull[22m,
  studentsCount: [33m0[39m,
  totalTranslations: [33m0[39m,
  averageLatency: [1mnull[22m,
  isActive: [33mtrue[39m,
  quality: [32m'unknown'[39m,
  qualityReason: [1mnull[22m,
  lastActivityAt: [35m2025-07-03T22:25:44.541Z[39m
}

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
2025-07-04 00:25:44 [[32minfo[39m]: Generated classroom code 7TYYCE for teacher session session-1-1751581544311

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
2025-07-04 00:25:44 [[32minfo[39m]: Updated connection: {"role":"teacher","languageCode":"en-US","settings":{}}

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
[DEBUG] Client #1 received message: classroom_code
[DEBUG] Client #1 received message: register

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
[TEST] Found message of type register for client #1: {
  type: [32m'register'[39m,
  status: [32m'success'[39m,
  data: { role: [32m'teacher'[39m, languageCode: [32m'en-US'[39m, settings: {} }
}

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
[TEST] Found message of type classroom_code for client #1: {
  type: [32m'classroom_code'[39m,
  code: [32m'7TYYCE'[39m,
  sessionId: [32m'session-1-1751581544311'[39m,
  expiresAt: [33m1751588744609[39m
}

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
=== Teacher registered with classroom code: 7TYYCE, sessionId: session-1-1751581544311 ===

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
=== Session after teacher registration === {
  id: [33m4750[39m,
  sessionId: [32m'session-1-1751581544311'[39m,
  isActive: [33mtrue[39m,
  studentsCount: [33m0[39m
}
=== Session is active, bug might be fixed already ===
[DEBUG] Creating WebSocket for path: /ws?code=7TYYCE (client #2) on port 56862

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
2025-07-04 00:25:44 [[32minfo[39m]: New WebSocket connection established
2025-07-04 00:25:44 [[32minfo[39m]: New WebSocket connection established
2025-07-04 00:25:44 [[32minfo[39m]: Client joining classroom 7TYYCE with session session-1-1751581544311
2025-07-04 00:25:44 [[32minfo[39m]: Sending connection confirmation: {"sessionId":"session-1-1751581544311","classroomCode":"7TYYCE"}
2025-07-04 00:25:44 [[32minfo[39m]: Connection confirmation sent successfully

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
[DEBUG] WebSocket OPENED for client #2
[DEBUG] Client #2 received message: connection

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
[TEST] Found message of type connection for client #2: {
  type: [32m'connection'[39m,
  status: [32m'connected'[39m,
  sessionId: [32m'session-1-1751581544311'[39m,
  classroomCode: [32m'7TYYCE'[39m
}

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
=== Student connection message === {
  type: [32m'connection'[39m,
  status: [32m'connected'[39m,
  sessionId: [32m'session-1-1751581544311'[39m,
  classroomCode: [32m'7TYYCE'[39m
}
=== Attempting student registration ===

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
2025-07-04 00:25:44 [[32minfo[39m]: Processing message type=register from connection: {"role":"student","languageCode":"es-ES","name":"Test Student"}
2025-07-04 00:25:44 [[32minfo[39m]: Changing connection role from undefined to student
2025-07-04 00:25:44 [[32minfo[39m]: Updated connection: {"role":"student","languageCode":"es-ES","settings":{}}

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
[DEBUG] Client #2 received message: register

stdout | tests/unit/services/TranslationService.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/unit/services/DiagnosticsService.test.ts
ðŸ”§ DATABASE: Loading test environment config from .env.test
ðŸ”§ DATABASE: NODE_ENV = test
ðŸ”§ DATABASE: DATABASE_URL exists = [33mtrue[39m
ðŸ”§ DATABASE: DATABASE_URL type = Neon

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
2025-07-04 00:25:44 [[32minfo[39m]: Student registration details: {"sessionId":"session-1-1751581544311","currentCount":0,"studentName":"Test Student","alreadyCounted":false,"classroomCode":"7TYYCE"}
[DbSessionStorage.updateSession] Attempting to update session: {
  sessionId: [32m'session-1-1751581544311'[39m,
  updates: {
    studentsCount: [33m1[39m,
    isActive: [33mtrue[39m,
    classCode: [32m'7TYYCE'[39m,
    studentLanguage: [32m'es-ES'[39m
  }
}

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
[DbSessionStorage.updateSession] Successfully updated session: {
  id: [33m4750[39m,
  sessionId: [32m'session-1-1751581544311'[39m,
  classCode: [32m'7TYYCE'[39m,
  teacherLanguage: [32m'en-US'[39m,
  studentLanguage: [32m'es-ES'[39m,
  startTime: [35m2025-07-03T22:25:44.541Z[39m,
  endTime: [1mnull[22m,
  studentsCount: [33m1[39m,
  totalTranslations: [33m0[39m,
  averageLatency: [1mnull[22m,
  isActive: [33mtrue[39m,
  quality: [32m'unknown'[39m,
  qualityReason: [1mnull[22m,
  lastActivityAt: [35m2025-07-03T22:25:44.541Z[39m
}

 â†“ tests/unit/services/DiagnosticsService.test.ts (14 tests | 14 skipped)
stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
2025-07-04 00:25:45 [[32minfo[39m]: Students rejoined session session-1-1751581544311 - grace period cancelled

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
2025-07-04 00:25:45 [[32minfo[39m]: Sent 'student_joined' to teacher for student: Test Student in session session-1-1751581544311

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
[DEBUG] Client #1 received message: student_joined

stdout | tests/unit/services/TranslationService.test.ts
OpenAI API key status: Present
OpenAI client initialized successfully

 â†“ tests/unit/services/TranslationService.test.ts (20 tests | 20 skipped)
stdout | tests/unit/database-storage.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/unit/storage/translation.storage.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
=== All messages received after student registration attempt === [
  {
    type: [32m'register'[39m,
    status: [32m'success'[39m,
    data: { role: [32m'student'[39m, languageCode: [32m'es-ES'[39m, settings: {} }
  }
]
=== Student registration succeeded === {
  type: [32m'register'[39m,
  status: [32m'success'[39m,
  data: { role: [32m'student'[39m, languageCode: [32m'es-ES'[39m, settings: {} }
}
=== END: Session lifecycle bug test ===

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
[TEST] Cleaning up...
2025-07-04 00:25:45 [[32minfo[39m]: [WebSocketServer] Shutting down...
2025-07-04 00:25:45 [[32minfo[39m]: [WebSocketServer] Session lifecycle interval cleared.
2025-07-04 00:25:45 [[32minfo[39m]: SessionCountCacheService stopped
2025-07-04 00:25:45 [[32minfo[39m]: [WebSocketServer] Session count cache service stopped.
2025-07-04 00:25:45 [[32minfo[39m]: SessionService shutdown completed
2025-07-04 00:25:45 [[32minfo[39m]: [WebSocketServer] SessionService shutdown completed.
2025-07-04 00:25:45 [[32minfo[39m]: Stopped session cleanup service
2025-07-04 00:25:45 [[32minfo[39m]: [WebSocketServer] SessionCleanupService stopped.
2025-07-04 00:25:45 [[32minfo[39m]: [WebSocketServer] Closing 2 client connections...
2025-07-04 00:25:45 [[32minfo[39m]: [WebSocketServer] All client connections terminated.
2025-07-04 00:25:45 [[32minfo[39m]: All classroom sessions cleared
2025-07-04 00:25:45 [[32minfo[39m]: [WebSocketServer] Internal maps and sets cleared.
2025-07-04 00:25:45 [[32minfo[39m]: [WebSocketServer] Shutdown complete.

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
[TestIsolation] Cleaning up storage for websocket-integration-test

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
[DEBUG] WebSocket closed for client #2. Code: 1006

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
[DEBUG] WebSocket closed for client #1. Code: 1006

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
2025-07-04 00:25:45 [[32minfo[39m]: WebSocket disconnected, sessionId: {}
2025-07-04 00:25:45 [[32minfo[39m]: WebSocket connection closed {}

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
2025-07-04 00:25:45 [[32minfo[39m]: WebSocket disconnected, sessionId: {}
2025-07-04 00:25:45 [[32minfo[39m]: WebSocket connection closed {}
2025-07-04 00:25:45 [[32minfo[39m]: [WebSocketServer] WebSocket server closed.

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
2025-07-04 00:25:46 [[32minfo[39m]: DatabaseStorage reset complete for test environment.

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)
[TEST] Cleanup complete

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests
[TEARDOWN] Closing test database...
Closing database connection...

stdout | tests/integration/services/WebSocketServer.integration.test.ts > WebSocketServer Comprehensive Integration Tests
Database connection closed.

 âœ“ tests/integration/services/WebSocketServer.integration.test.ts (29 tests | 28 skipped) 4189ms
   âœ“ WebSocketServer Comprehensive Integration Tests > BUGFIX: student should be able to join immediately after teacher registers (session lifecycle bug)  3324ms
 â†“ tests/unit/storage/translation.storage.test.ts (18 tests | 18 skipped)
stdout | tests/unit/database-storage.test.ts
ðŸ”§ DATABASE: Loading test environment config from .env.test
ðŸ”§ DATABASE: NODE_ENV = test
ðŸ”§ DATABASE: DATABASE_URL exists = [33mtrue[39m
ðŸ”§ DATABASE: DATABASE_URL type = Neon

stdout | tests/unit/services/websocket/RegisterMessageHandler.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/unit/database-storage.test.ts (17 tests | 17 skipped)
 â†“ tests/unit/services/websocket/RegisterMessageHandler.test.ts (17 tests | 17 skipped)
stdout | tests/unit/routes.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/integration/translation-flow-integration.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/unit/storage/language.storage.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/integration/translation-flow-integration.test.ts (5 tests | 5 skipped)
 â†“ tests/unit/routes.test.ts (21 tests | 21 skipped)
stdout | tests/unit/services/websocket/ConnectionLifecycleManager.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/integration/services/audio-pipeline-integration.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/unit/services/websocket/ConnectionLifecycleManager.test.ts (17 tests | 17 skipped)
stdout | tests/integration/services/audio-pipeline-integration.test.ts
OpenAI API key status: Present
OpenAI client initialized successfully

 â†“ tests/integration/services/audio-pipeline-integration.test.ts (5 tests | 5 skipped)
stdout | tests/unit/storage/transcript.storage.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/unit/storage/language.storage.test.ts (23 tests | 23 skipped)
stdout | tests/unit/services/websocket/ClassroomSessionManager.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/unit/services/websocket/ClassroomSessionManager.test.ts (31 tests | 31 skipped)
stdout | tests/unit/services/websocket/TranslationOrchestrator.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/unit/services/websocket/TranslationOrchestrator.test.ts (11 tests | 11 skipped)
stdout | tests/unit/services/WebSocketServer.lifecycle.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/integration/session-lifecycle.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/unit/storage/transcript.storage.test.ts (11 tests | 11 skipped)
stdout | tests/unit/services/WebSocketServer.lifecycle.test.ts
OpenAI API key status: Present
OpenAI client initialized successfully

 â†“ tests/unit/services/WebSocketServer.lifecycle.test.ts (17 tests | 17 skipped)
stdout | tests/unit/services/websocket/ConnectionManager.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/unit/services/websocket/ConnectionManager.test.ts (20 tests | 20 skipped)
stdout | tests/unit/services/SessionCleanupService.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/unit/core/translation.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/unit/core/translation.test.ts
OpenAI API key status: Present
OpenAI client initialized successfully

 â†“ tests/unit/core/translation.test.ts (10 tests | 10 skipped)
stdout | tests/integration/session-lifecycle.test.ts
ðŸ”§ DATABASE: Loading test environment config from .env.test
ðŸ”§ DATABASE: NODE_ENV = test
ðŸ”§ DATABASE: DATABASE_URL exists = [33mtrue[39m
ðŸ”§ DATABASE: DATABASE_URL type = Neon

 â†“ tests/integration/session-lifecycle.test.ts (10 tests | 10 skipped)
stdout | tests/unit/services/websocket/TTSRequestMessageHandler.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/unit/services/websocket/TTSRequestMessageHandler.test.ts (13 tests | 13 skipped)
stdout | tests/unit/services/AudioTranscriptionService.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/unit/services/SessionCleanupService.test.ts (16 tests | 16 skipped)
 â†“ tests/unit/services/AudioTranscriptionService.test.ts (12 tests | 12 skipped)
stdout | tests/unit/storage/user.storage.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/unit/services/SpeechTranslationService.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/unit/services/SessionLifecycleService.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/unit/services/SessionLifecycleService.test.ts (8 tests | 8 skipped)
stdout | tests/unit/services/SpeechTranslationService.test.ts
OpenAI API key status: Present
OpenAI client initialized successfully

 â†“ tests/unit/services/SpeechTranslationService.test.ts (8 tests | 8 skipped)
stdout | tests/unit/core/audio-processing.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/unit/services/SessionCountCacheService.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/unit/core/audio-processing.test.ts (11 tests | 11 skipped)
 â†“ tests/unit/storage/user.storage.test.ts (13 tests | 13 skipped)
 â†“ tests/unit/services/SessionCountCacheService.test.ts (17 tests | 17 skipped)
stdout | tests/unit/services/websocket/SettingsMessageHandler.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/unit/services/websocket/SettingsMessageHandler.test.ts (9 tests | 9 skipped)
stdout | tests/unit/services/websocket/TranscriptionMessageHandler.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/unit/services/websocket/TranscriptionMessageHandler.test.ts (7 tests | 7 skipped)
stdout | tests/unit/index.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/unit/index.test.ts (2 tests | 2 skipped)
stdout | tests/integration/services/openai.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/unit/api/routes.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/unit/api/routes.test.ts (7 tests | 7 skipped)
stdout | tests/unit/services/websocket/SessionService.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/integration/services/openai.test.ts
OpenAI API key status: Present
OpenAI client initialized successfully

 â†“ tests/integration/services/openai.test.ts (5 tests | 5 skipped)
 â†“ tests/unit/services/websocket/SessionService.test.ts (13 tests | 13 skipped)
stdout | tests/integration/services/translation-with-tts-integration.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/unit/services/websocket/AudioMessageHandler.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/unit/services/websocket/AudioMessageHandler.test.ts (8 tests | 8 skipped)
stdout | tests/unit/services/websocket/MessageHandler.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/integration/services/translation-with-tts-integration.test.ts
OpenAI API key status: Present
OpenAI client initialized successfully

 â†“ tests/integration/services/translation-with-tts-integration.test.ts (5 tests | 5 skipped)
 â†“ tests/unit/services/websocket/MessageHandler.test.ts (10 tests | 10 skipped)
stdout | tests/unit/config.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/integration/workflows/performance.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/unit/config.test.ts (8 tests | 8 skipped)
stdout | tests/unit/services/websocket/PingMessageHandler.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/integration/workflows/performance.test.ts (10 tests | 10 skipped)
 â†“ tests/unit/services/websocket/PingMessageHandler.test.ts (6 tests | 6 skipped)
stdout | tests/unit/services/websocket/PongMessageHandler.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/unit/services/websocket/PongMessageHandler.test.ts (7 tests | 7 skipped)
stdout | tests/integration/api/routes.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/integration/message-handling-integration.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/unit/services/HeartbeatManager.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/unit/services/HeartbeatManager.test.ts (2 tests | 2 skipped)
stdout | tests/integration/message-handling-integration.test.ts
OpenAI API key status: Present
OpenAI client initialized successfully

stdout | tests/integration/workflows/language-coverage.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/integration/workflows/language-coverage.test.ts (2 tests | 2 skipped)
stdout | tests/unit/services/AudioFileHandler.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/unit/services/AudioFileHandler.test.ts (4 tests | 4 skipped)
stdout | tests/integration/api/routes.test.ts
ðŸ”§ DATABASE: Loading test environment config from .env.test
ðŸ”§ DATABASE: NODE_ENV = test
ðŸ”§ DATABASE: DATABASE_URL exists = [33mtrue[39m
ðŸ”§ DATABASE: DATABASE_URL type = Neon

stdout | tests/unit/openai.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/integration/api/routes.test.ts
OpenAI API key status: Present
OpenAI client initialized successfully

 â†“ tests/integration/api/routes.test.ts (4 tests | 4 skipped)
stdout | tests/integration/message-handling-integration.test.ts
ðŸ”§ DATABASE: Loading test environment config from .env.test
ðŸ”§ DATABASE: NODE_ENV = test
ðŸ”§ DATABASE: DATABASE_URL exists = [33mtrue[39m
ðŸ”§ DATABASE: DATABASE_URL type = Neon

 â†“ tests/integration/message-handling-integration.test.ts (1 test | 1 skipped)
stdout | tests/unit/openai.test.ts
OpenAI API key status: Present
OpenAI client initialized successfully

 â†“ tests/unit/openai.test.ts (3 tests | 3 skipped)
stdout | tests/integration/workflows/edge-cases.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/integration/workflows/edge-cases.test.ts (3 tests | 3 skipped)
stdout | tests/integration/simple-persistence-diagnostic.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/unit/services/DevelopmentModeHelper.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/unit/services/DevelopmentModeHelper.test.ts (3 tests | 3 skipped)
stdout | tests/integration/server/server-middleware.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/unit/server.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

stdout | tests/integration/simple-persistence-diagnostic.test.ts
ðŸ”§ DATABASE: Loading test environment config from .env.test
ðŸ”§ DATABASE: NODE_ENV = test
ðŸ”§ DATABASE: DATABASE_URL exists = [33mtrue[39m
ðŸ”§ DATABASE: DATABASE_URL type = Neon

 â†“ tests/integration/simple-persistence-diagnostic.test.ts (2 tests | 2 skipped)
stdout | tests/integration/server/server-middleware.test.ts
ðŸ”§ DATABASE: Loading test environment config from .env.test
ðŸ”§ DATABASE: NODE_ENV = test
ðŸ”§ DATABASE: DATABASE_URL exists = [33mtrue[39m
ðŸ”§ DATABASE: DATABASE_URL type = Neon

stdout | tests/integration/workflows/error-recovery.test.ts
Test environment configured successfully from .env.test:
- Node Environment: test
- Host: 0.0.0.0
- Port: 5000
- TTS Service: openai
- OpenAI Key: Set
- Database URL: Set
- Redis URL: Set
- Log Level: info
- Vite API URL: http://127.0.0.1:5000
- Vite WS URL: ws://127.0.0.1:5000

 â†“ tests/integration/workflows/error-recovery.test.ts (3 tests | 3 skipped)
stdout | tests/integration/server/server-middleware.test.ts
OpenAI API key status: Present
OpenAI client initialized successfully

stdout | tests/unit/server.test.ts
ðŸ”§ DATABASE: Loading test environment config from .env.test
ðŸ”§ DATABASE: NODE_ENV = test
ðŸ”§ DATABASE: DATABASE_URL exists = [33mtrue[39m
ðŸ”§ DATABASE: DATABASE_URL type = Neon

stdout | tests/integration/server/server-middleware.test.ts
ðŸ”§ SERVER/SERVER: Loading environment from .env.test (NODE_ENV=test)

 â†“ tests/integration/server/server-middleware.test.ts (2 tests | 2 skipped)
stdout | tests/unit/server.test.ts
OpenAI API key status: Present
OpenAI client initialized successfully

stdout | tests/unit/server.test.ts
ðŸ”§ SERVER/SERVER: Loading environment from .env.test (NODE_ENV=test)

 â†“ tests/unit/server.test.ts (3 tests | 3 skipped)

 Test Files  1 passed | 55 skipped (56)
      Tests  1 passed | 705 skipped (706)
   Start at  00:25:36
   Duration  41.64s (transform 3.73s, setup 2.60s, collect 63.73s, tests 4.19s, environment 107ms, prepare 22.97s)

