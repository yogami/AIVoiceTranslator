<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Benedictaitor Test Runner</title>
  <style>
    :root {
      --primary: #3C8DBC;
      --success: #34A853;
      --error: #EA4335;
      --warning: #FBBC05;
      --info: #4285F4;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f8f9fa;
      color: #333;
      height: 100vh;
      overflow: hidden;
    }
    
    .container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      box-sizing: border-box;
    }
    
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #e0e0e0;
    }
    
    h1 {
      margin: 0;
      font-size: 24px;
      color: var(--primary);
    }
    
    .version {
      font-size: 14px;
      color: #666;
    }
    
    .main-content {
      display: flex;
      flex: 1;
      gap: 20px;
      overflow: hidden;
    }
    
    .sidebar {
      width: 250px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      padding: 15px;
      overflow-y: auto;
    }
    
    .sidebar h2 {
      font-size: 18px;
      margin-top: 0;
      color: #333;
    }
    
    .test-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .test-item {
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: background-color 0.2s;
      border-left: 3px solid transparent;
    }
    
    .test-item:hover {
      background-color: #f5f5f5;
      border-left-color: var(--primary);
    }
    
    .test-item.active {
      background-color: #e0f0ff;
      border-left-color: var(--primary);
    }
    
    .action-buttons {
      margin-top: 20px;
    }
    
    button {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
      margin-bottom: 10px;
      width: 100%;
      text-align: center;
    }
    
    button:hover {
      background-color: #3079a9;
    }
    
    button.secondary {
      background-color: #f0f0f0;
      color: #333;
    }
    
    button.secondary:hover {
      background-color: #e0e0e0;
    }
    
    .output-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      overflow: hidden;
    }
    
    .output-header {
      padding: 15px;
      border-bottom: 1px solid #e0e0e0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .output-title {
      font-size: 18px;
      margin: 0;
    }
    
    .output-content {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      background-color: #1e1e1e;
      color: #d4d4d4;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.5;
    }
    
    .output-line {
      margin: 0;
      padding: 2px 0;
      white-space: pre-wrap;
      word-break: break-all;
    }
    
    .info {
      color: #4285F4;
    }
    
    .error {
      color: #EA4335;
    }
    
    .warning {
      color: #FBBC05;
    }
    
    .success {
      color: #34A853;
    }
    
    .status-bar {
      padding: 10px 15px;
      background-color: #f8f9fa;
      border-top: 1px solid #e0e0e0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
    }
    
    .status-indicator {
      display: flex;
      align-items: center;
    }
    
    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .status-dot.idle {
      background-color: #90A4AE;
    }
    
    .status-dot.running {
      background-color: var(--info);
      animation: pulse 1.5s infinite;
    }
    
    .status-dot.success {
      background-color: var(--success);
    }
    
    .status-dot.error {
      background-color: var(--error);
    }
    
    @keyframes pulse {
      0% {
        opacity: 1;
      }
      50% {
        opacity: 0.5;
      }
      100% {
        opacity: 1;
      }
    }
    
    .test-summary {
      margin-top: 20px;
      padding: 15px;
      background-color: #f5f5f5;
      border-radius: 4px;
    }
    
    .summary-title {
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .summary-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
    }
    
    @media (max-width: 768px) {
      .main-content {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
        margin-bottom: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Benedictaitor Test Runner</h1>
      <span class="version">v1.0.0</span>
    </header>
    
    <div class="main-content">
      <div class="sidebar">
        <h2>Available Tests</h2>
        <ul class="test-list" id="testList">
          <!-- Test items will be populated here -->
        </ul>
        
        <div class="action-buttons">
          <button id="runAllTests">Run All Tests</button>
          <button id="runSelectedTest" class="secondary" disabled>Run Selected Test</button>
          <button id="saveResults" class="secondary" disabled>Save Results</button>
        </div>
        
        <div class="test-summary" id="testSummary" style="display: none;">
          <div class="summary-title">Test Summary</div>
          <div class="summary-item">
            <span>Total:</span>
            <span id="totalTests">0</span>
          </div>
          <div class="summary-item">
            <span>Passed:</span>
            <span id="passedTests">0</span>
          </div>
          <div class="summary-item">
            <span>Failed:</span>
            <span id="failedTests">0</span>
          </div>
          <div class="summary-item">
            <span>Duration:</span>
            <span id="testDuration">0s</span>
          </div>
        </div>
      </div>
      
      <div class="output-panel">
        <div class="output-header">
          <h2 class="output-title">Test Output</h2>
          <button id="clearOutput" class="secondary" style="width: auto; margin: 0;">Clear</button>
        </div>
        <div class="output-content" id="outputContent">
          <p class="output-line info">Benedictaitor Test Runner initialized.</p>
          <p class="output-line info">Select a test from the sidebar or click "Run All Tests" to begin.</p>
        </div>
        <div class="status-bar">
          <div class="status-indicator">
            <div class="status-dot idle" id="statusDot"></div>
            <span id="statusText">Ready</span>
          </div>
          <div id="elapsedTime">00:00:00</div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Import required Electron modules
    const { ipcRenderer } = require('electron');
    const fs = require('fs');
    const path = require('path');
    
    // DOM elements
    const testListElement = document.getElementById('testList');
    const outputContentElement = document.getElementById('outputContent');
    const runAllTestsButton = document.getElementById('runAllTests');
    const runSelectedTestButton = document.getElementById('runSelectedTest');
    const saveResultsButton = document.getElementById('saveResults');
    const clearOutputButton = document.getElementById('clearOutput');
    const statusDotElement = document.getElementById('statusDot');
    const statusTextElement = document.getElementById('statusText');
    const elapsedTimeElement = document.getElementById('elapsedTime');
    const testSummaryElement = document.getElementById('testSummary');
    const totalTestsElement = document.getElementById('totalTests');
    const passedTestsElement = document.getElementById('passedTests');
    const failedTestsElement = document.getElementById('failedTests');
    const testDurationElement = document.getElementById('testDuration');
    
    // State variables
    let selectedTest = null;
    let testResults = [];
    let startTime = null;
    let timerInterval = null;
    let testSummary = {
      total: 0,
      passed: 0,
      failed: 0,
      duration: 0
    };
    
    // Initialize the app
    function init() {
      loadTestList();
      setupEventListeners();
      ipcRenderer.on('test-output', handleTestOutput);
      ipcRenderer.on('save-results-response', handleSaveResultsResponse);
    }
    
    // Load available tests from the tests directory
    function loadTestList() {
      const testsDir = path.join(__dirname, 'tests');
      
      try {
        if (!fs.existsSync(testsDir)) {
          fs.mkdirSync(testsDir, { recursive: true });
        }
        
        // List of predefined test types if no actual files exist
        const defaultTests = [
          'websocket-tests',
          'selenium-test',
          'speech-test',
          'audio-utils-tests'
        ];
        
        let files = [];
        try {
          files = fs.readdirSync(testsDir);
        } catch (err) {
          console.error('Error reading tests directory:', err);
          // Use default tests if directory can't be read
          files = defaultTests.map(test => `${test}.js`);
        }
        
        const testFiles = files.filter(file => file.endsWith('.js'));
        
        if (testFiles.length === 0) {
          // If no test files found, use default tests
          defaultTests.forEach(test => {
            const listItem = createTestListItem(test, `${test}.js`);
            testListElement.appendChild(listItem);
          });
        } else {
          testFiles.forEach(file => {
            const testName = file.replace('.js', '');
            const listItem = createTestListItem(testName, file);
            testListElement.appendChild(listItem);
          });
        }
        
        updateTestSummary();
      } catch (err) {
        console.error('Error loading test list:', err);
        addOutputLine(`Error loading test list: ${err.message}`, 'error');
      }
    }
    
    // Create a list item for a test
    function createTestListItem(testName, fileName) {
      const listItem = document.createElement('li');
      listItem.className = 'test-item';
      listItem.textContent = formatTestName(testName);
      listItem.dataset.test = testName;
      listItem.dataset.file = fileName;
      
      listItem.addEventListener('click', () => {
        // Remove active class from all test items
        document.querySelectorAll('.test-item').forEach(item => {
          item.classList.remove('active');
        });
        
        // Add active class to clicked item
        listItem.classList.add('active');
        
        // Set selected test
        selectedTest = {
          name: testName,
          file: fileName
        };
        
        // Enable run selected test button
        runSelectedTestButton.disabled = false;
      });
      
      return listItem;
    }
    
    // Format test name for display
    function formatTestName(name) {
      return name
        .replace(/[-_]/g, ' ')
        .replace(/\b\w/g, c => c.toUpperCase());
    }
    
    // Set up event listeners
    function setupEventListeners() {
      runAllTestsButton.addEventListener('click', () => {
        resetStatus();
        startTimer();
        setStatus('running', 'Running all tests...');
        saveResultsButton.disabled = true;
        
        ipcRenderer.send('run-all-tests');
      });
      
      runSelectedTestButton.addEventListener('click', () => {
        if (selectedTest) {
          resetStatus();
          startTimer();
          setStatus('running', `Running test: ${formatTestName(selectedTest.name)}`);
          saveResultsButton.disabled = true;
          
          ipcRenderer.send('run-test', selectedTest.name);
        }
      });
      
      saveResultsButton.addEventListener('click', () => {
        ipcRenderer.send('save-results', testResults);
      });
      
      clearOutputButton.addEventListener('click', () => {
        outputContentElement.innerHTML = '';
        addOutputLine('Output cleared.', 'info');
      });
    }
    
    // Handle test output from main process
    function handleTestOutput(event, data) {
      addOutputLine(data.message, data.type);
      
      testResults.push({
        timestamp: new Date().toISOString(),
        type: data.type,
        test: data.test || 'general',
        message: data.message
      });
      
      if (data.type === 'success' || data.type === 'error') {
        if (data.message.includes('finished with exit code')) {
          const isSuccess = data.type === 'success';
          updateTestSummary(isSuccess);
          
          if (data.message.includes('All tests completed')) {
            stopTimer();
            setStatus(isSuccess ? 'success' : 'error', isSuccess ? 'All tests completed successfully' : 'Tests completed with errors');
            saveResultsButton.disabled = false;
          }
        }
      }
    }
    
    // Handle save results response
    function handleSaveResultsResponse(event, response) {
      if (response.success) {
        addOutputLine(response.message, 'success');
      } else {
        addOutputLine(response.message, 'error');
      }
    }
    
    // Add a line to the output panel
    function addOutputLine(message, type = 'info') {
      const line = document.createElement('p');
      line.className = `output-line ${type}`;
      line.textContent = message;
      
      outputContentElement.appendChild(line);
      outputContentElement.scrollTop = outputContentElement.scrollHeight;
    }
    
    // Set the status indicator
    function setStatus(state, text) {
      statusDotElement.className = `status-dot ${state}`;
      statusTextElement.textContent = text;
    }
    
    // Reset the status and results
    function resetStatus() {
      testResults = [];
      stopTimer();
      testSummary = {
        total: 0,
        passed: 0,
        failed: 0,
        duration: 0
      };
    }
    
    // Start the timer
    function startTimer() {
      startTime = new Date();
      
      if (timerInterval) {
        clearInterval(timerInterval);
      }
      
      timerInterval = setInterval(() => {
        const elapsed = new Date() - startTime;
        elapsedTimeElement.textContent = formatElapsedTime(elapsed);
      }, 1000);
    }
    
    // Stop the timer
    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      
      if (startTime) {
        const elapsed = new Date() - startTime;
        testSummary.duration = elapsed;
        elapsedTimeElement.textContent = formatElapsedTime(elapsed);
        testDurationElement.textContent = formatElapsedTime(elapsed);
      }
    }
    
    // Format elapsed time
    function formatElapsedTime(elapsed) {
      const seconds = Math.floor((elapsed / 1000) % 60);
      const minutes = Math.floor((elapsed / (1000 * 60)) % 60);
      const hours = Math.floor(elapsed / (1000 * 60 * 60));
      
      return [
        hours.toString().padStart(2, '0'),
        minutes.toString().padStart(2, '0'),
        seconds.toString().padStart(2, '0')
      ].join(':');
    }
    
    // Update test summary
    function updateTestSummary(isSuccess = null) {
      if (isSuccess !== null) {
        testSummary.total++;
        
        if (isSuccess) {
          testSummary.passed++;
        } else {
          testSummary.failed++;
        }
      }
      
      totalTestsElement.textContent = testSummary.total;
      passedTestsElement.textContent = testSummary.passed;
      failedTestsElement.textContent = testSummary.failed;
      
      testSummaryElement.style.display = 'block';
    }
    
    // Initialize the app
    init();
  </script>
</body>
</html>